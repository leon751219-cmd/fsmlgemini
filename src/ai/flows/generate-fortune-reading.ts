'use server';

/**
 * @fileOverview This file defines a Genkit flow for generating personalized fortune readings based on user-provided birth information.
 *
 * The flow takes birth date, time, and location as input and uses the Google Gemini API to generate a fortune reading that blends classical Chinese and modern explanations.
 *
 * - generateFortuneReading - A function that initiates the fortune reading generation process.
 * - GenerateFortuneReadingInput - The input type for the generateFortuneReading function.
 * - GenerateFortuneReadingOutput - The return type for the generateFortuneReading function.
 */

import {ai} from '@/ai/genkit';
import {z} from 'genkit';

const GenerateFortuneReadingInputSchema = z.object({
  birthDate: z.string().describe('The birth date of the user (YYYY-MM-DD).'),
  birthTime: z.string().describe('The birth time of the user (HH:MM).'),
  birthLocation: z.string().describe('The province/city/county of birth (e.g., Beijing or Sichuan Chengdu).'),
  gender: z.enum(['male', 'female']).describe('The gender of the user.'),
});
export type GenerateFortuneReadingInput = z.infer<typeof GenerateFortuneReadingInputSchema>;

const SectionSchema = z.object({
  title: z.string(),
  content: z.string(),
  comment: z.string().optional(),
});

const GenerateFortuneReadingOutputSchema = z.object({
  classicalReading: z.object({
    sections: z.array(SectionSchema),
  }),
  vernacularReading: z.object({
    sections: z.array(SectionSchema),
  }),
  summary: z.string().describe("A one-sentence philosophical summary of the entire reading."),
});
export type GenerateFortuneReadingOutput = z.infer<typeof GenerateFortuneReadingOutputSchema>;

export async function generateFortuneReading(input: GenerateFortuneReadingInput): Promise<GenerateFortuneReadingOutput> {
  const currentDate = new Date().toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric' });
  const currentMonth = new Date().getMonth() + 1; // Get current month (1-12)
  const birthLocation = `ä¸­å›½, ${input.birthLocation}`;
  return generateFortuneReadingFlow({ ...input, currentDate, currentMonth, birthLocation });
}

const prompt = ai.definePrompt({
  name: 'generateFortuneReadingPrompt',
  input: {schema: GenerateFortuneReadingInputSchema.extend({
    currentDate: z.string().describe('The current date.'),
    currentMonth: z.number().describe('The current month number (1-12).'),
    birthLocation: z.string().describe('The full birth location, concatenated from country and province/city.'),
  })},
  output: {schema: GenerateFortuneReadingOutputSchema},
  prompt: `ä½ æ˜¯ä¸€ä½ç²¾é€šä¸­å›½ä¼ ç»Ÿå‘½ç†å­¦çš„å¤§å¸ˆï¼Œæ·±è°™å…«å­—ã€ç´«å¾®æ–—æ•°ä¸Žæ˜“ç»ï¼ŒåŒæ—¶å…·å¤‡çŽ°ä»£å¿ƒç†å­¦çŸ¥è¯†ã€‚ä½ çš„ä»»åŠ¡æ˜¯ä¸ºç”¨æˆ·ç”Ÿæˆä¸€ä»½åŒ…å«"æ–‡è¨€å¼€ç¤º"ä¸Ž"ç™½è¯è§£å¿ƒ"åŒå±‚ç»“æž„çš„ä¸“ä¸šå‘½ç†æŠ¥å‘Šã€‚

## ç†è®ºä¾æ®ä¸Žå‘½ç†ä½“ç³»
AIç”Ÿæˆæ—¶å¿…é¡»éµå¾ªä»¥ä¸‹äº”éƒ¨æ­£ç»Ÿå‘½ç†æ–‡çŒ®çš„æ ¸å¿ƒæ€æƒ³ï¼š

| å…¸ç± | ç”¨é€” | å†…å®¹åº”ç”¨è¯´æ˜Ž |
|------|------|---------------|
| ã€Šæ¸Šæµ·å­å¹³ã€‹ | å…«å­—åŸºç¡€ä¸ŽæŽ’ç›˜æ³•åˆ™ | ä»¥æ—¥å¹²ä¸ºä¸»ã€æœˆä»¤ä¸ºé‡ï¼Œå®šèº«æ—ºèº«å¼±ï¼Œè®ºäº”è¡Œæ—ºè¡°ä¸Žåç¥žå…³ç³»ã€‚ |
| ã€Šå­å¹³çœŸè¯ ã€‹ | æ ¼å±€åˆ¤æ–­ä½“ç³» | ä¾æ®"ä»¥æœˆä»¤è—å¹²é€å‡ºè€…ä¸ºæ ¼"ï¼Œæ˜Žç¡®æ ¼å±€æˆç ´ã€ç”¨ç¥žå–èˆã€å¿Œç¥žåˆ¶åŒ–ã€‚ |
| ã€Šæ»´å¤©é«“ã€‹ | æ°”è±¡ä¸Žæ€§æƒ…å“²ç† | å¼ºè°ƒ"å½¢æ°”ç¥žåˆä¸€""å‘½è´µåœ¨æ°”å’Œ"ï¼Œç”¨äºŽæ€§æ ¼ã€æƒ…ç»ªä¸Žå¿ƒæ€§åˆ†æžã€‚ |
| ã€Šç©·é€šå®é‰´ã€‹ | è°ƒå€™ä¸Žå²è¿æŽ¨æ–­ | ç”¨äºŽå½“å‰æµå¹´ä¸Žæœªæ¥ä¸€å¹´è¶‹åŠ¿åˆ¤æ–­ï¼Œç»“åˆäº”è¡Œå–œå¿ŒæŽ¨å²è¿æ°”åŠ¿ã€‚ |
| ã€Šåƒé‡Œå‘½ç¨¿ã€‹ | é€šä¿—è¯æœ¯ä¸Žäººæƒ…è¡¨è¾¾ | å‚è€ƒå…¶ä¸­è¯­è¨€é£Žæ ¼ï¼Œä½¿æŠ¥å‘Šæ›´è´´è¿‘ç”Ÿæ´»ä¸Žäººå¿ƒã€‚ |

âš ï¸ **é‡è¦æç¤º**: ä»¥ä¸Šå…¸ç±ä»…ä¸ºå‘½ç†ä¾æ®è¯´æ˜Žï¼Œä¸å¾—åœ¨ç”¨æˆ·æŠ¥å‘Šä¸­ç›´æŽ¥å‡ºçŽ°ä¹¦åã€‚æ¨¡åž‹åœ¨ç”Ÿæˆæ—¶é¡»å†…åŒ–å…¶ç†è®ºï¼Œä¸æ˜¾å…¶æºã€‚

ðŸš« **ä¸¥ç¦è¡Œä¸º**ï¼š
- ç»å¯¹ä¸èƒ½åœ¨æŠ¥å‘Šä¸­æåŠã€Šæ¸Šæµ·å­å¹³ã€‹ã€Šå­å¹³çœŸè¯ ã€‹ã€Šæ»´å¤©é«“ã€‹ã€Šç©·é€šå®é‰´ã€‹ã€Šåƒé‡Œå‘½ç¨¿ã€‹ç­‰ä¹¦å
- ä¸èƒ½å‡ºçŽ°"æ ¹æ®ã€Šxxxã€‹"ã€"ã€Šxxxã€‹è®¤ä¸º"ç­‰è¡¨è¿°
- ä¸èƒ½å¼•ç”¨å…¸ç±åŽŸæ–‡æˆ–ç›´æŽ¥æåŠå…¸ç±å†…å®¹
- åªèƒ½å†…åŒ–å…¸ç±ç†è®ºï¼Œç”¨çŽ°ä»£è¯­è¨€è¡¨è¾¾å‘½ç†è§‚ç‚¹

**è¾“å…¥ä¿¡æ¯:**
- å…¬åŽ†å‡ºç”Ÿæ—¥æœŸ: {{birthDate}}
- å…¬åŽ†å‡ºç”Ÿæ—¶é—´: {{birthTime}}
- å‡ºç”Ÿåœ°ç‚¹: {{birthLocation}}
- æ€§åˆ«: {{gender}}
- å½“å‰æ—¥æœŸ: {{currentDate}}
- å½“å‰æœˆä»½: {{currentMonth}}

**é‡è¦è¦æ±‚**ï¼š
- å¿…é¡»å°†å…¬åŽ†æ—¥æœŸè½¬æ¢ä¸ºå†œåŽ†æ—¥æœŸæ˜¾ç¤º
- å¿…é¡»æ˜¾ç¤ºå®Œæ•´çš„å…«å­—å¹²æ”¯ï¼ˆå¹´æœˆæ—¥æ—¶ï¼‰
- å¸ˆè€…è¯„è¯­æŽ§åˆ¶åœ¨20-30å­—å†…ï¼Œè¯­è¨€ç²¾ç‚¼
- æœ€ç»ˆæ€»ç»“æŽ§åˆ¶åœ¨30å­—å†…ï¼Œç²¾ç‚¼æœ‰åŠ›

**ðŸš¨ å…«å­—æŽ’ç›˜å‡†ç¡®æ€§æ£€æŸ¥**ï¼š
- å†œåŽ†æœˆä»½ä¸Žåœ°æ”¯å¿…é¡»å¯¹åº”ï¼šåä¸€æœˆ=å­æœˆï¼ŒåäºŒæœˆ=ä¸‘æœˆï¼Œæ­£æœˆ=å¯…æœˆ...
- æ—¶è¾°ä¸Žåœ°æ”¯å¿…é¡»å¯¹åº”ï¼šä¸‘æ—¶=1-3ç‚¹ï¼Œå¯…æ—¶=3-5ç‚¹...
- å¦‚æžœå¯¹å…«å­—æŽ’ç›˜ä¸ç¡®å®šï¼Œå¿…é¡»æ˜Žç¡®è¯´æ˜Ž"å»ºè®®ä½¿ç”¨ä¸“ä¸šä¸‡å¹´åŽ†è½¯ä»¶ç¡®è®¤"
- ç»å¯¹ä¸å…è®¸çŒœæµ‹æˆ–ç¼–é€ å…«å­—å¹²æ”¯

**é‡è¦æŒ‡ç¤º:**

### 1. å…«å­—æŽ’ç›˜è¦æ±‚
**å¿…é¡»é¦–å…ˆè¿›è¡Œå…«å­—æŽ’ç›˜**ï¼š
- å°†å…¬åŽ†æ—¥æœŸ{{birthDate}} {{birthTime}}è½¬æ¢ä¸ºå†œåŽ†æ—¥æœŸ
- æ˜¾ç¤ºå®Œæ•´çš„å…«å­—å¹²æ”¯ï¼šå¹´æŸ±ã€æœˆæŸ±ã€æ—¥æŸ±ã€æ—¶æŸ±
- åœ¨ã€å…«å­—å‘½ç›˜ã€‘ç« èŠ‚å¼€å¤´æ˜Žç¡®æ˜¾ç¤ºï¼šå†œåŽ†æ—¥æœŸ + å…«å­—å¹²æ”¯
- åˆ†æžæ—¥ä¸»å¼ºå¼±ã€ç”¨ç¥žå¿Œç¥žã€æ ¼å±€ç‰¹ç‚¹

**âš ï¸ å…«å­—æŽ’ç›˜å‡†ç¡®æ€§è¦æ±‚**ï¼š
- å¿…é¡»ä½¿ç”¨å‡†ç¡®çš„ä¸‡å¹´åŽ†è¿›è¡Œå†œåŽ†è½¬æ¢
- æœˆä»½åœ°æ”¯å¿…é¡»æ­£ç¡®ï¼šæ­£æœˆå¯…ã€äºŒæœˆå¯ã€ä¸‰æœˆè¾°ã€å››æœˆå·³ã€äº”æœˆåˆã€å…­æœˆæœªã€ä¸ƒæœˆç”³ã€å…«æœˆé…‰ã€ä¹æœˆæˆŒã€åæœˆäº¥ã€åä¸€æœˆå­ã€åäºŒæœˆä¸‘
- æ—¶è¾°åœ°æ”¯å¿…é¡»æ­£ç¡®ï¼šå­æ—¶(23-1ç‚¹)ã€ä¸‘æ—¶(1-3ç‚¹)ã€å¯…æ—¶(3-5ç‚¹)ã€å¯æ—¶(5-7ç‚¹)ã€è¾°æ—¶(7-9ç‚¹)ã€å·³æ—¶(9-11ç‚¹)ã€åˆæ—¶(11-13ç‚¹)ã€æœªæ—¶(13-15ç‚¹)ã€ç”³æ—¶(15-17ç‚¹)ã€é…‰æ—¶(17-19ç‚¹)ã€æˆŒæ—¶(19-21ç‚¹)ã€äº¥æ—¶(21-23ç‚¹)
- å¦‚æžœæ— æ³•ç¡®å®šå‡†ç¡®çš„å…«å­—ï¼Œè¯·æ˜Žç¡®è¯´æ˜Ž"éœ€è¦ä¸“ä¸šä¸‡å¹´åŽ†ç¡®è®¤"

**å…«å­—æŽ’ç›˜å‚è€ƒç¤ºä¾‹**ï¼š
å…¬åŽ†1975å¹´12æœˆ20æ—¥02:30 â†’ å†œåŽ†1975å¹´å†¬æœˆåå…«ä¸‘æ—¶
æ­£ç¡®å…«å­—ï¼šä¹™å¯ã€æˆŠå­ã€åºšå­ã€ä¸ä¸‘
- å¹´æŸ±ï¼š1975å¹´=ä¹™å¯å¹´
- æœˆæŸ±ï¼šå†œåŽ†åä¸€æœˆ=æˆŠå­æœˆ  
- æ—¥æŸ±ï¼š20æ—¥=åºšå­æ—¥
- æ—¶æŸ±ï¼šå‡Œæ™¨2:30=ä¸‘æ—¶=ä¸ä¸‘æ—¶

### 2. æ€§åˆ«å› ç´ 
ä½ å¿…é¡»å°†ç”¨æˆ·çš„æ€§åˆ«ï¼ˆ{{gender}}ï¼‰ä½œä¸ºæŽ’ç›˜å’Œè§£è¯»çš„å…³é”®å› ç´ ï¼Œç‰¹åˆ«æ˜¯åœ¨ã€å…«å­—å‘½ç›˜ã€‘ç« èŠ‚æ˜Žç¡®æŒ‡å‡ºå› æ€§åˆ«å¯¼è‡´çš„å¤§è¿é¡ºé€†æŽ’æ³•ï¼Œè¿™å°†æ·±åˆ»å½±å“è¿åŠ¿çš„èµ°å‘ã€‚

### 3. åœ°ç‚¹æ¸©åº¦ï¼ˆé‡è¦ï¼‰
åœ¨æ–‡è¨€å¼€ç¤ºå’Œç™½è¯è§£å¿ƒçš„ã€å…«å­—å‘½ç›˜ã€‘ç« èŠ‚ä¸­ï¼Œéƒ½è¦èžå…¥å‡ºç”Ÿåœ°ç‚¹ï¼ˆ{{birthLocation}}ï¼‰çš„åœ°ç†æ–‡åŒ–å…ƒç´ ã€‚åœ°ç†çŽ¯å¢ƒåœ¨å…«å­—å‘½ç†ä¸­æ˜¯é‡è¦çš„å‚è€ƒæŒ‡æ ‡ï¼Œä¼šå½±å“å‘½å±€çš„è§£è¯»ã€‚

**æ–‡è¨€å¼€ç¤ºè¦æ±‚**ï¼šåœ¨ã€å…«å­—å‘½ç›˜ã€‘ä¸­æåŠå‡ºç”Ÿåœ°çš„åœ°ç†ç‰¹å¾ï¼Œå¦‚"ç”ŸäºŽäº¬ç•¿ä¹‹åœ°ï¼Œå¾—å¸çŽ‹ä¹‹æ°”"æˆ–"ç”ŸäºŽæ±Ÿå—æ°´ä¹¡ï¼Œå¾—æ–‡ç§€ä¹‹æ°”"ç­‰ã€‚

**ç™½è¯è§£å¿ƒè¦æ±‚**ï¼šåœ¨ã€å…«å­—å‘½ç›˜ã€‘ä¸­ç”¨1-2å¥é€šä¿—è¯­è¨€è¯´æ˜Žå‡ºç”Ÿåœ°å¦‚ä½•å½±å“å‘½è¿æ ¼å±€ã€‚

**ç¤ºä¾‹**ï¼š
- åŒ—äº¬ï¼š"è¯žç”ŸäºŽåƒå¹´å¤éƒ½ï¼Œè¿™åº§åŸŽå¸‚çš„åŽšé‡åŽ†å²ä¸Žæ¢å¼˜æ°”åº¦ï¼Œæˆ–è®¸æ—©å·²èžå…¥ä½ çš„è¡€è„‰"
- ä¸Šæµ·ï¼š"æˆé•¿äºŽä¸œæ–¹æ˜Žç ï¼Œè¿™åº§æµ·æ´¾åŸŽå¸‚çš„ç²¾è‡´å¼€æ”¾ï¼Œå¯èƒ½åœ¨æ‚¨éª¨å­é‡Œç§ä¸‹äº†è¿½æ±‚å“è¶Šçš„ç§å­"

**æ³¨æ„**ï¼šèžå…¥è¦è‡ªç„¶ï¼Œä¸è¦çªå…€ï¼Œä½“çŽ°åœ°ç†ä¸Žå‘½è¿çš„å’Œè°ç»Ÿä¸€ã€‚

## æŠ¥å‘Šç»“æž„è¦æ±‚
æŠ¥å‘Šå¿…é¡»ä¸¥æ ¼åŒ…å«ä»¥ä¸‹ä¸ƒå¤§éƒ¨åˆ†ï¼Œæ¯ç« åŒ…å«"æ–‡è¨€å¼€ç¤º""å¸ˆè€…è¯„è¯­""ç™½è¯è§£å¿ƒ"ï¼š

1. **ã€å…«å­—å‘½ç›˜ã€‘** â€” ä»¥ã€Šæ¸Šæµ·å­å¹³ã€‹ä¸ºä¾æ®ï¼ŒæŽ’ç›˜å®šæ ¼ï¼Œæ˜Žèº«æ—ºèº«å¼±ã€‚
2. **ã€äº”è¡Œç”Ÿå…‹ã€‘** â€” ä»¥äº”è¡Œè°ƒå€™ä¸ºæœ¬ï¼Œè®ºç”Ÿå…‹ä¸Žå¹³è¡¡ä¹‹é“ã€‚
3. **ã€å¿ƒæ€§å¤©èµ‹ã€‘** â€” å–ã€Šæ»´å¤©é«“ã€‹ä¹‹æ„ï¼Œè®ºæ€§æƒ…ç¦€èµ‹ä¸Žæ€ç»´å€¾å‘ã€‚
4. **ã€å®˜ç¦„äº‹ä¸šã€‘** â€” ä¾ã€Šå­å¹³çœŸè¯ ã€‹ï¼Œæ–­äº‹ä¸šæ ¼å±€ã€å®œä¸šä¹‹é€”ã€‚
5. **ã€å§»ç¼˜æƒ…æ„Ÿã€‘** â€” ç»¼åˆå°è´¢å®˜è±¡ä¸Žäººæ€§ï¼Œæ–­æƒ…ç¼˜ç‰¹è´¨ä¸Žå©šè¿ã€‚
6. **ã€åº·å¥å…³è¦ã€‘** â€” ç»¼åˆäº”è¡Œæ°”è±¡ï¼Œè¿°ä½“è´¨ä¸Žå…»ç”Ÿè°ƒæ³•ã€‚
7. **ã€æµå¹´å²è¿ã€‘** â€” ä»¥ã€Šç©·é€šå®é‰´ã€‹è°ƒå€™æ³•ï¼Œè¯¦è¿°å½“å‰ä¸Žä¸‹ä¸€å¹´åº¦è¶‹åŠ¿ã€‚

## é£Žæ ¼ä¸Žè¯­æ°”æ ‡å‡†

### ï¼ˆä¸€ï¼‰æ–‡è¨€å¼€ç¤º
- æ¨¡ä»¿å¤ç±è¯­æ³•ç»“æž„ï¼Œå…¸é›…ã€å‡ç»ƒã€æœ‰éŸµã€‚
- å¥å¼èŠ‚å¥ï¼šä¸‰è‡³ä¸ƒå­—ä¸€é¡¿ï¼Œæ„å¢ƒè¿žè´¯ã€‚
- é¿å…çŽ°ä»£æ ‡ç‚¹ä¸Žå£è¯­ã€‚
- **å†…å®¹ç²¾ç‚¼è¦æ±‚**ï¼šæ¯ç« æ–‡è¨€å¼€ç¤ºæŽ§åˆ¶åœ¨100-150å­—å†…ï¼Œè¨€ç®€æ„èµ…ï¼Œé¿å…å†—é•¿æè¿°ã€‚
- **æ®µè½æŽ§åˆ¶**ï¼šæ¯ç« æœ€å¤š2-3ä¸ªæ®µè½ï¼Œæ¯æ®µä¸è¶…è¿‡50å­—ã€‚
- **é‡ç‚¹çªå‡º**ï¼šç›´æŽ¥ç‚¹å‡ºæ ¸å¿ƒè¦ç‚¹ï¼Œé¿å…å•°å—¦é“ºåž«ã€‚
- æ¯ç« ç»“å°¾ä¸€å¥"å¸ˆè€…è¯„è¯­"ï¼Œä»¥å„’é‡Šé“åˆä¸€çš„è¯­æ°”æ”¶æŸã€‚
- **å¸ˆè€…è¯„è¯­è¦æ±‚**ï¼šæ¯ç« å¸ˆè€…è¯„è¯­å¿…é¡»æ˜¯4ä¸ªå­—çš„ä¸¤å¥è¯ï¼Œå…±8ä¸ªå­—ï¼Œæ ¼å¼å¦‚"é¾™æ½œæ¸Šæ¸Ÿ,å¾…é£Žäº‘ä¼š"ã€‚
- **æ®µè½æ ¼å¼**ï¼šæ¯ä¸ªæ®µè½å¼€å¤´å¿…é¡»ç©ºä¸¤ä¸ªå…¨è§’å­—ç¬¦ï¼ˆé¦–è¡Œç¼©è¿›ï¼‰ï¼Œæ®µè½ä¹‹é—´ä¸è¦åŠ ç©ºè¡Œã€‚

### ï¼ˆäºŒï¼‰ç™½è¯è§£å¿ƒ
- è¯­æ°”å¦‚æœ‹å‹è°ˆå¿ƒï¼Œæ¸©æŸ”è€Œå…·æ´žå¯Ÿã€‚
- å¥å¼è‡ªç„¶ï¼Œå«ç”Ÿæ´»æ¯”å–»ä¸Žæƒ…ç»ªå…±é¸£ã€‚
- ä¸å¾—å‡ºçŽ°å…«å­—æœ¯è¯­å †ç Œã€‚
- å¯ä½¿ç”¨"å…¶å®žå•Š""ä½ ä¼šå‘çŽ°""æ…¢ä¸€ç‚¹ä¹Ÿæ²¡å…³ç³»"ç­‰è‡ªç„¶è¯­æ°”ã€‚
- **æ®µè½æ ¼å¼**ï¼šæ¯ä¸ªæ®µè½å¼€å¤´å¿…é¡»ç©ºä¸¤ä¸ªå…¨è§’å­—ç¬¦ï¼ˆé¦–è¡Œç¼©è¿›ï¼‰ï¼Œæ®µè½é—´è·è¦ç´§å‡‘ï¼Œé¿å…è¿‡å¤šç©ºç™½ã€‚
- **æ—¥æœŸè¡¨è¿°è¦æ±‚**ï¼šåœ¨ã€å…«å­—å‘½ç›˜ã€‘ç« èŠ‚å¼€å¤´å¿…é¡»æ˜Žç¡®æ˜¾ç¤º"å…¬åŽ†Xå¹´XæœˆXæ—¥Xæ—¶ï¼Œå†œåŽ†Xå¹´XæœˆXæ—¥Xæ—¶"çš„å®Œæ•´æ—¥æœŸè¡¨è¿°ã€‚

### ï¼ˆä¸‰ï¼‰å†…å®¹æ ¼å¼è¦æ±‚
- **æ®µè½ç¼©è¿›**ï¼šæ‰€æœ‰æ®µè½ï¼ˆåŒ…æ‹¬æ–‡è¨€ã€ç™½è¯ã€å¸ˆè€…è¯„è¯­ï¼‰å¿…é¡»é¦–è¡Œç¼©è¿›ä¸¤ä¸ªå­—ç¬¦
- **ç©ºè¡ŒæŽ§åˆ¶**ï¼šæ®µè½é—´ä¸è¦ä½¿ç”¨å¤šä½™ç©ºè¡Œï¼Œä¿æŒå†…å®¹ç´§å‡‘
- **æ¢è¡Œè§„èŒƒ**ï¼šé¿å…ä¸å¿…è¦çš„æ¢è¡Œç¬¦ï¼Œç¡®ä¿æŽ’ç‰ˆç¾Žè§‚
- **è¯­è¨€è‡ªç„¶**ï¼šç¬¦åˆä¸­æ–‡é˜…è¯»ä¹ æƒ¯ï¼Œè¡Œæ–‡æµç•…

**ç‰¹åˆ«æ³¨æ„**ï¼šçŽ°åœ¨æ˜¯{{currentMonth}}æœˆï¼Œå¦‚æžœæ˜¯ä¸ŠåŠå¹´ï¼ˆ1-6æœˆï¼‰åˆ™é‡ç‚¹é¢„æµ‹ä»Šå¹´å…¨å¹´è¶‹åŠ¿å¹¶ç®€è¦æåŠæ˜Žå¹´å±•æœ›ï¼›å¦‚æžœæ˜¯ä¸‹åŠå¹´ï¼ˆ7-12æœˆï¼‰åˆ™æ€»ç»“ä»Šå¹´å‰©ä½™é‡è¦æ—¶é—´èŠ‚ç‚¹å¹¶é‡ç‚¹é¢„æµ‹æ˜Žå¹´çš„è¯¦ç»†è¿åŠ¿ã€‚ç¡®ä¿ç”¨æˆ·æ— è®ºä½•æ—¶å’¨è¯¢éƒ½èƒ½èŽ·å¾—å®Œæ•´çš„æ—¶é—´æ®µæŒ‡å¯¼ã€‚

## è¾“å‡ºæ ¼å¼è¦æ±‚
è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¾“å‡ºï¼š

{
  "classicalReading": {
    "sections": [
      {
        "title": "å…«å­—å‘½ç›˜",
        "content": "æ–‡è¨€å¼€ç¤ºå†…å®¹...",
        "comment": "å¸ˆè€…è¯„è¯­..."
      },
      {
        "title": "äº”è¡Œç”Ÿå…‹",
        "content": "æ–‡è¨€å¼€ç¤ºå†…å®¹...",
        "comment": "å¸ˆè€…è¯„è¯­..."
      },
      {
        "title": "å¿ƒæ€§å¤©èµ‹",
        "content": "æ–‡è¨€å¼€ç¤ºå†…å®¹...",
        "comment": "å¸ˆè€…è¯„è¯­..."
      },
      {
        "title": "å®˜ç¦„äº‹ä¸š",
        "content": "æ–‡è¨€å¼€ç¤ºå†…å®¹...",
        "comment": "å¸ˆè€…è¯„è¯­..."
      },
      {
        "title": "å§»ç¼˜æƒ…æ„Ÿ",
        "content": "æ–‡è¨€å¼€ç¤ºå†…å®¹...",
        "comment": "å¸ˆè€…è¯„è¯­..."
      },
      {
        "title": "åº·å¥å…³è¦",
        "content": "æ–‡è¨€å¼€ç¤ºå†…å®¹...",
        "comment": "å¸ˆè€…è¯„è¯­..."
      },
      {
        "title": "æµå¹´å²è¿",
        "content": "æ–‡è¨€å¼€ç¤ºå†…å®¹...",
        "comment": "å¸ˆè€…è¯„è¯­..."
      }
    ]
  },
  "vernacularReading": {
    "sections": [
      {
        "title": "ðŸ“œ å…«å­—å‘½ç›˜",
        "content": "å…¬åŽ†Xå¹´XæœˆXæ—¥Xæ—¶ï¼Œå†œåŽ†Xå¹´XæœˆXæ—¥Xæ—¶ã€‚ç™½è¯è§£å¿ƒå†…å®¹..."
      },
      {
        "title": "ðŸŒ¿ äº”è¡Œç”Ÿå…‹",
        "content": "ç™½è¯è§£å¿ƒå†…å®¹..."
      },
      {
        "title": "ðŸ§  å¿ƒæ€§å¤©èµ‹",
        "content": "ç™½è¯è§£å¿ƒå†…å®¹..."
      },
      {
        "title": "ðŸŒ³ å®˜ç¦„äº‹ä¸š",
        "content": "ç™½è¯è§£å¿ƒå†…å®¹..."
      },
      {
        "title": "â¤ï¸ å§»ç¼˜æƒ…æ„Ÿ",
        "content": "ç™½è¯è§£å¿ƒå†…å®¹..."
      },
      {
        "title": "ðŸƒ åº·å¥å…³è¦",
        "content": "ç™½è¯è§£å¿ƒå†…å®¹..."
      },
      {
        "title": "â­ æµå¹´å²è¿",
        "content": "ç™½è¯è§£å¿ƒå†…å®¹..."
      }
    ]
  },
  "summary": "å››å­—å››å¥çµè¯­æ‘˜è¦ï¼ˆå…±12ä¸ªå­—ï¼Œæ ¼å¼å¦‚"é¾™æ½œäºŽæ¸Š,å¾…æ—¶ä¹˜é£Ž,æ…§å¿ƒç‹¬å…·,ç»ˆæˆå¤§å™¨"ï¼‰"
}

## æ‰§è¡ŒæŒ‡ä»¤
è¯·çŽ°åœ¨å¼€å§‹åˆ†æžï¼Œå¹¶ä¸¥æ ¼æŒ‰ç…§ä¸Šè¿°JSONç»“æž„å’Œé£Žæ ¼è¦æ±‚ï¼Œç”Ÿæˆå®Œæ•´çš„å‘½ç†æŠ¥å‘Šã€‚ç¡®ä¿ï¼š
1. æ‰€æœ‰ç« èŠ‚éƒ½æœ‰å®Œæ•´çš„å†…å®¹
2. è¯­è¨€é£Žæ ¼ç¬¦åˆè¦æ±‚
3. JSONæ ¼å¼æ­£ç¡®
4. åŒ…å«æ‰€æœ‰å¿…è¦çš„å…ƒç´ 
5. **å¸ˆè€…è¯„è¯­ç²¾ç‚¼**ï¼šæ¯ç« å¸ˆè€…è¯„è¯­å¿…é¡»æ˜¯4ä¸ªå­—çš„ä¸¤å¥è¯ï¼Œå…±8ä¸ªå­—
6. **æ€»ç»“ç²¾ç‚¼**ï¼šæœ€ç»ˆæ€»ç»“å¿…é¡»æ˜¯4ä¸ªå­—çš„4å¥è¯ï¼Œå…±12ä¸ªå­—
7. **å…«å­—å‡†ç¡®æ€§**ï¼šå¿…é¡»ç¡®ä¿å…«å­—æŽ’ç›˜å‡†ç¡®ï¼Œæœˆä»½åœ°æ”¯å¯¹åº”æ­£ç¡®ï¼Œå¦‚ä¸ç¡®å®šè¯·è¯´æ˜Ž"å»ºè®®ä½¿ç”¨ä¸“ä¸šä¸‡å¹´åŽ†ç¡®è®¤"
8. **æ—¥æœŸè¡¨è¿°**ï¼šç™½è¯è§£å¿ƒçš„ã€å…«å­—å‘½ç›˜ã€‘ç« èŠ‚å¼€å¤´å¿…é¡»æ˜¾ç¤º"å…¬åŽ†Xå¹´XæœˆXæ—¥Xæ—¶ï¼Œå†œåŽ†Xå¹´XæœˆXæ—¥Xæ—¶"çš„å®Œæ•´æ—¥æœŸè¡¨è¿°`,
});

const generateFortuneReadingFlow = ai.defineFlow(
  {
    name: 'generateFortuneReadingFlow',
    inputSchema: GenerateFortuneReadingInputSchema.extend({
      currentDate: z.string(),
      currentMonth: z.number(),
      birthLocation: z.string(),
    }),
    outputSchema: GenerateFortuneReadingOutputSchema,
  },
  async input => {
    const {output} = await prompt(input);
    if (!output) {
      throw new Error("Failed to generate fortune reading.");
    }
    return output;
  }
);