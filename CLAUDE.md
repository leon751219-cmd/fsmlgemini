# å¸¸æ¸…é˜ AI å‘½ç†ç³»ç»Ÿ - é¡¹ç›®æŠ€æœ¯æ–‡æ¡£

> **é¡¹ç›®åç§°**: å¸¸æ¸…é˜ AI å‘½ç†ç³»ç»Ÿ (ç„å¦™æ´å¯Ÿå‘½ç†æŠ¥å‘Šç”Ÿæˆç³»ç»Ÿ)
> **åˆ›å»ºæ—¶é—´**: 2025-01-26
> **æœ€åæ›´æ–°**: 2025-01-26
> **é¡¹ç›®çŠ¶æ€**: âœ… V2 ç‰ˆæœ¬å‡çº§å®Œæˆï¼Œå‡†å¤‡ Vercel éƒ¨ç½²
> **å½“å‰æŠ€æœ¯æ ˆ**: Next.js 15.3.3 + TypeScript + Tailwind CSS + React 18 + Google Gemini AI

---

## ğŸ“‹ é¡¹ç›®æ¦‚è§ˆ

### é¡¹ç›®å®šä½
**å¸¸æ¸…é˜**æ˜¯ä¸€ä¸ªèåˆä¼ ç»Ÿæ–‡åŒ–ä¸ç°ä»£AIæŠ€æœ¯çš„ä¸“ä¸šå‘½ç†å åœåº”ç”¨ã€‚é€šè¿‡ç”¨æˆ·çš„ç”Ÿè¾°å…«å­—ä¿¡æ¯ï¼Œåˆ©ç”¨ **Google Gemini AI** ç”ŸæˆåŒ…å«æ–‡è¨€å¼€ç¤ºå’Œç™½è¯è§£å¿ƒåŒå±‚ç»“æ„çš„ä¸“ä¸šå‘½ç†æŠ¥å‘Šã€‚

### æŠ€æœ¯æ¶æ„
```
ç”¨æˆ·è¡¨å•æäº¤ â†’ FortuneFormç»„ä»¶ â†’ generateFortuneReadingå‡½æ•° â†’
è°ƒç”¨ Gemini API (Genkit) â†’ JSONè§£æéªŒè¯ â†’ FortuneResultå±•ç¤º
```

### æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§
1. **ğŸ§® ä¸“ä¸šå‘½ç†åˆ†æ**: åŸºäºå…«å­—ã€ç´«å¾®æ–—æ•°ã€æ˜“ç»çš„ä¼ ç»Ÿå‘½ç†å­¦
2. **ğŸ¤– AI æ™ºèƒ½æŠ¥å‘Šç”Ÿæˆ**: Google Gemini 2.5 Flash é©±åŠ¨ï¼Œ6000-9000å­—è¯¦ç»†æŠ¥å‘Š
3. **ğŸ“„ æŠ¥å‘Šå±•ç¤ºç³»ç»Ÿ**: æ–‡è¨€å¼€ç¤º + å¸ˆè€…è¯„è¯­ + ç™½è¯è§£å¿ƒä¸‰å±‚ç»“æ„
4. **ğŸ¨ ç°ä»£åŒ–UIè®¾è®¡**: é“å®¶é£æ ¼è®¾è®¡ï¼ŒğŸ® ç¯ç¬¼ç¬¦å·ï¼Œé˜´é˜³å…ƒç´ 
5. **ğŸ’¾ æ™ºèƒ½ç¼“å­˜**: 24å°æ—¶TTLç¼“å­˜æœºåˆ¶
6. **ğŸ“¸ æŠ¥å‘Šå¯¼å‡º**: HTML2Canvas é«˜æ¸…å›¾ç‰‡ç”Ÿæˆ

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„è¯¦ç»†åˆ†æ

### æ ¸å¿ƒæŠ€æœ¯ç»„ä»¶

#### 1. AI æœåŠ¡å±‚ (V2ç‰ˆæœ¬)
**æ–‡ä»¶**: `src/ai/flows/generate-fortune-reading.ts`
**æŠ€æœ¯æ ˆ**: Google Gemini + Genkit + ZodéªŒè¯
**å…³é”®ç‰¹æ€§**:
- ä½¿ç”¨ V2 å®Œæ•´ prompt æ¨¡æ¿
- èå…¥äº”éƒ¨æ­£ç»Ÿå‘½ç†å…¸ç±ç†è®º
- 6000-9000å­—è¯¦ç»†å‘½ç†æŠ¥å‘Šç”Ÿæˆ
- æ€§åˆ«å’Œåœ°ç†å› ç´ æ·±åº¦åˆ†æ
- 24å°æ—¶ç¼“å­˜æœºåˆ¶ï¼Œå‡å°‘APIè°ƒç”¨
- æ™ºèƒ½æ—¶é—´é¢„æµ‹ (æ ¹æ®å½“å‰æœˆä»½åŠ¨æ€è°ƒæ•´)

#### 2. Google Gemini é›†æˆ
**æ–‡ä»¶**: `src/ai/genkit.ts`
**é…ç½®å‚æ•°**:
```typescript
export const ai = genkit({
  plugins: [googleAI()],
  model: 'googleai/gemini-2.5-flash',
});
```

#### 3. ç¼“å­˜ç³»ç»Ÿ
**æ–‡ä»¶**: `src/lib/local-cache.ts`
**åŠŸèƒ½ç‰¹æ€§**:
- MD5å“ˆå¸Œç¼“å­˜é”®ç”Ÿæˆ
- 24å°æ—¶TTLè‡ªåŠ¨è¿‡æœŸ
- æœ€å¤š1000æ¡ç›®ç®¡ç†
- å®šæœŸæ¸…ç†å’Œç»Ÿè®¡
- âš ï¸ **æ³¨æ„**: Vercel Serverless ç¯å¢ƒä¸‹éœ€è¦æ”¹ä¸ºå†…å­˜ç¼“å­˜

#### 4. å‘½ç†æ¨¡æ¿ç³»ç»Ÿ
**æ–‡ä»¶**: `src/prompts/`
- `fortune-template-v1.md`: åŸºç¡€ç‰ˆæœ¬æ¨¡æ¿
- `fortune-template-v2.md`: V2é«˜çº§æ¨¡æ¿ (äº”éƒ¨å…¸ç±ç†è®º)

---

## ğŸ¯ V2 ç‰ˆæœ¬é‡å¤§å‡çº§å†…å®¹

### ğŸ›ï¸ AI ç³»ç»Ÿå‡çº§ (V1 â†’ V2)

#### æ ¸å¿ƒç†è®ºå‡çº§
**äº”éƒ¨æ­£ç»Ÿå‘½ç†å…¸ç±å®Œæ•´é›†æˆ**:
1. **ã€Šæ¸Šæµ·å­å¹³ã€‹**: å…«å­—åŸºç¡€ä¸æ’ç›˜æ³•åˆ™
2. **ã€Šå­å¹³çœŸè¯ ã€‹**: æ ¼å±€åˆ¤æ–­ä½“ç³»
3. **ã€Šæ»´å¤©é«“ã€‹**: æ°”è±¡ä¸æ€§æƒ…å“²ç†
4. **ã€Šç©·é€šå®é‰´ã€‹**: è°ƒå€™ä¸å²è¿æ¨æ–­
5. **ã€Šåƒé‡Œå‘½ç¨¿ã€‹**: é€šä¿—è¯æœ¯ä¸äººæƒ…è¡¨è¾¾

#### æœ¯è¯­å‡çº§
- **V1ç‰ˆæœ¬**: "æ–‡è¨€è§£è¯»"
- **V2ç‰ˆæœ¬**: **"æ–‡è¨€å¼€ç¤º"** (æ›´ä¸“ä¸š)

#### å­—æ•°è§„èŒƒå‡çº§
- **å…¨æ–‡æ€»å­—æ•°**: **6000-9000å­—**
- **å„ç« èŠ‚**: æ–‡è¨€+ç™½è¯ä¸å°‘äº400å­—
- **æµå¹´å²è¿**: ä¸å°‘äº600å­—
- **æ™ºèƒ½æ‰©å†™**: ä¸è¶³5000å­—è‡ªåŠ¨è¡¥å…¨ï¼Œè¶…è¿‡10000å­—è‡ªåŠ¨ç²¾ç®€

#### æ—¶é—´æ™ºèƒ½é¢„æµ‹
- æ ¹æ®å½“å‰æœˆä»½ (1-12æœˆ) åŠ¨æ€è°ƒæ•´é¢„æµ‹é‡ç‚¹
- ä¸ŠåŠå¹´ (1-6æœˆ): é‡ç‚¹é¢„æµ‹å½“å¹´ï¼Œç®€è¦æåŠæ˜å¹´
- ä¸‹åŠå¹´ (7-12æœˆ): æ€»ç»“å½“å¹´å‰©ä½™ï¼Œé‡ç‚¹é¢„æµ‹æ˜å¹´

### ğŸ¨ UI è§†è§‰ç³»ç»Ÿå‡çº§

#### ç°ä»£åŒ–è®¾è®¡å…ƒç´ 
- **ğŸ® ç¯ç¬¼ç¬¦å·æ•ˆæœ**: CSSåŠ¨ç”»é—ªçƒ (`@keyframes flicker`)
- **å®¹å™¨èƒŒæ™¯è®¾è®¡**: `bg-cyan-950/20 rounded-lg border border-cyan-400/20`
- **ä¸“ä¸šCSSç±»å**: `classical-reading`, `vernacular-reading`, `section-title`
- **æ®µè½å¤„ç†**: `content.split('\n').map()` æ™ºèƒ½åˆ†æ®µæ˜¾ç¤º

#### CSS æ ·å¼ç³»ç»Ÿ (æ–°å¢163è¡Œ)
```css
/* ç¯ç¬¼ç¬¦å·æ ·å¼ */
.teacher-comment::before {
  display: inline-block;
  margin-right: 0.5rem;
  font-size: 1.1em;
  animation: flicker 3s ease-in-out infinite;
}

/* æ–‡è¨€å¼€ç¤ºä¸“ç”¨æ ¼å¼ */
.classical-reading p {
  text-indent: 2em;
  margin: 0.2rem 0;
  line-height: 1.5;
  font-family: 'Noto Serif SC', serif;
  letter-spacing: 0.05em;
}

/* ç´§å‡‘æ ¼å¼ä¼˜åŒ– */
.section-item {
  margin-bottom: 0.8rem !important;
  padding: 0.3rem 0 !important;
}
```

---

## ğŸ“Š é¡¹ç›®æ–‡ä»¶ç»“æ„

### æ ¸å¿ƒç›®å½•ç»“æ„
```
src/
â”œâ”€â”€ ai/                           # AI æ ¸å¿ƒé€»è¾‘
â”‚   â”œâ”€â”€ genkit.ts                 # Genkit é…ç½®
â”‚   â”œâ”€â”€ dev.ts                   # å¼€å‘ç¯å¢ƒé…ç½®
â”‚   â””â”€â”€ flows/
â”‚       â””â”€â”€ generate-fortune-reading.ts  # V2 AI æ ¸å¿ƒç”Ÿæˆé€»è¾‘
â”œâ”€â”€ app/                          # Next.js åº”ç”¨å±‚
â”‚   â”œâ”€â”€ layout.tsx               # æ ¹å¸ƒå±€ç»„ä»¶
â”‚   â”œâ”€â”€ page.tsx                 # ä¸»é¡µé¢æ§åˆ¶å™¨
â”‚   â””â”€â”€ globals.css               # å…¨å±€æ ·å¼ (293è¡Œ)
â”œâ”€â”€ components/                   # React ç»„ä»¶
â”‚   â”œâ”€â”€ fortune-form.tsx          # è¡¨å•ç»„ä»¶
â”‚   â”œâ”€â”€ fortune-result.tsx       # ç»“æœå±•ç¤ºç»„ä»¶
â”‚   â”œâ”€â”€ loading-animation.tsx    # åŠ è½½åŠ¨ç”»
â”‚   â”œâ”€â”€ mystical-background.tsx  # èƒŒæ™¯æ•ˆæœ
â”‚   â”œâ”€â”€ yin-yang-icon.tsx        # å¤ªæå›¾æ ‡
â”‚   â””â”€â”€ ui/                     # UI ç»„ä»¶åº“
â”œâ”€â”€ lib/                          # å·¥å…·åº“
â”‚   â”œâ”€â”€ deepseek.ts              # DeepSeek API (å·²åºŸå¼ƒ)
â”‚   â”œâ”€â”€ local-cache.ts           # æœ¬åœ°ç¼“å­˜
â”‚   â”œâ”€â”€ generate-report-image.ts  # æŠ¥å‘Šå›¾ç‰‡ç”Ÿæˆ
â”‚   â””â”€â”€ utils.ts                 # é€šç”¨å·¥å…·
â””â”€â”€ prompts/                      # å‘½ç†æ¨¡æ¿
    â”œâ”€â”€ fortune-template-v1.md   # åŸºç¡€æ¨¡æ¿
    â””â”€â”€ fortune-template-v2.md   # V2é«˜çº§æ¨¡æ¿
```

---

## ğŸš€ Vercel éƒ¨ç½²é…ç½®

### éƒ¨ç½²æ–‡ä»¶é…ç½®
**æ–‡ä»¶**: `vercel.json`
```json
{
  "buildCommand": "npm run build",
  "outputDirectory": ".next",
  "installCommand": "npm install",
  "framework": "nextjs",
  "env": {
    "GOOGLE_API_KEY": "@google-api-key"
  },
  "functions": {
    "src/app/**/*.ts": {
      "maxDuration": 30
    }
  }
}
```

### ç¯å¢ƒå˜é‡é…ç½®
```bash
# Vercel ç”Ÿäº§ç¯å¢ƒ
GOOGLE_API_KEY=your_google_gemini_api_key_here
NODE_ENV=production
```

### ç¼“å­˜ç³»ç»Ÿé€‚é…æ–¹æ¡ˆ
**é—®é¢˜**: æœ¬åœ°æ–‡ä»¶ç¼“å­˜åœ¨ Vercel Serverless ç¯å¢ƒæ— æ•ˆ
**è§£å†³æ–¹æ¡ˆ**: å®æ–½å†…å­˜ç¼“å­˜æˆ– Vercel KV

```typescript
// src/lib/vercel-cache.ts (Vercel å…¼å®¹ç‰ˆæœ¬)
class VercelMemoryCache {
  private cache = new Map<string, { data: any; timestamp: number }>();

  set(key: string, data: any, ttlHours: number = 24): void {
    this.cache.set(key, {
      data,
      timestamp: Date.now() + (ttlHours * 60 * 60 * 1000)
    });
  }

  get(key: string): any | null {
    const cached = this.cache.get(key);
    if (!cached || Date.now() > cached.timestamp) {
      this.cache.delete(key);
      return null;
    }
    return cached.data;
  }
}
```

---

## ğŸ“± é¡¹ç›®ä¾èµ–åˆ†æ

### æ ¸å¿ƒä¾èµ–åŒ…
```json
{
  "dependencies": {
    "@genkit-ai/google-genai": "^1.21.0",
    "@genkit-ai/next": "^1.21.0",
    "genkit": "^1.21.0",
    "genkit-cli": "^1.21.0",
    "next": "15.3.3",
    "react": "^18.3.1",
    "zod": "^3.24.2",
    "typescript": "^5"
  }
}
```

### UI ç»„ä»¶ä¾èµ–
- **Radix UI**: å®Œæ•´çš„ UI ç»„ä»¶åº“
- **Framer Motion**: åŠ¨ç”»æ•ˆæœ
- **Lucide React**: å›¾æ ‡åº“
- **Tailwind CSS**: æ ·å¼ç³»ç»Ÿ

### å¼€å‘å·¥å…·ä¾èµ–
- **TypeScript**: ç±»å‹æ£€æŸ¥
- **ESLint**: ä»£ç è´¨é‡æ£€æŸ¥
- **PostCSS**: CSS å¤„ç†

---

## ğŸ”§ å¼€å‘å·¥ä½œæµç¨‹

### æœ¬åœ°å¼€å‘
```bash
# 1. å®‰è£…ä¾èµ–
npm install

# 2. é…ç½®ç¯å¢ƒå˜é‡
echo "GOOGLE_API_KEY=your_key_here" > .env.local

# 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev
```

### æ„å»ºå’Œéƒ¨ç½²
```bash
# 1. æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# 2. ç±»å‹æ£€æŸ¥
npm run typecheck

# 3. ä»£ç æ£€æŸ¥
npm run lint
```

### Genkit å¼€å‘ (å¯é€‰)
```bash
# å¯åŠ¨ Genkit å¼€å‘æœåŠ¡å™¨
npm run genkit:dev

# ç›‘å¬æ–‡ä»¶å˜åŒ–
npm run genkit:watch
```

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡ä¸ä¼˜åŒ–

### AI ç”Ÿæˆæ€§èƒ½
- **API å“åº”æ—¶é—´**: 30-60ç§’ (Gemini API)
- **ç¼“å­˜å‘½ä¸­å“åº”**: <100ms
- **æŠ¥å‘Šå­—æ•°**: 6000-9000å­—
- **Token ä½¿ç”¨**: ~8000 tokens per request

### å‰ç«¯æ€§èƒ½
- **é¦–æ¬¡åŠ è½½**: <5ç§’
- **é¡µé¢å¤§å°**: 97 kB + 101 kB (shared)
- **ç¼“å­˜å‘½ä¸­ç‡**: 60-80%
- **Lighthouse è¯„åˆ†**: ç›®æ ‡ > 90

### æˆæœ¬åˆ†æ
- **Gemini API**: çº¦ $0.002/æ¬¡
- **Vercel Pro**: $20/æœˆ
- **é¢„ä¼°æœˆåº¦**: æ ¹æ®ä½¿ç”¨é‡è®¡ç®—

---

## ğŸ”’ å®‰å…¨ä¸éšç§

### API å®‰å…¨
- âœ… API å¯†é’¥é€šè¿‡ç¯å¢ƒå˜é‡ç®¡ç†
- âœ… å®¢æˆ·ç«¯æ— æ³•è®¿é—® API å¯†é’¥
- âœ… è¾“å…¥éªŒè¯é€šè¿‡ Zod Schema
- âœ… é”™è¯¯å¤„ç†æœºåˆ¶å®Œå–„

### æ•°æ®éšç§
- âœ… ç”Ÿè¾°å…«å­—ä¿¡æ¯æœ¬åœ°å¤„ç†
- âœ… æ— ç”¨æˆ·æ•°æ®å­˜å‚¨åˆ°ç¬¬ä¸‰æ–¹
- âœ… ç¬¦åˆéšç§ä¿æŠ¤è¦æ±‚
- âœ… GDPR å…¼å®¹è®¾è®¡

---

## ğŸ¨ UI/UX è®¾è®¡è§„èŒƒ

### è®¾è®¡é£æ ¼
- **ä¸»é¢˜**: é“å®¶ç„å­¦é£æ ¼
- **é…è‰²**: æ·±è“è‰²èƒŒæ™¯ + é’è‰²/é‡‘è‰²ç‚¹ç¼€
- **å­—ä½“**: ä¸­æ–‡å­—ä½“ä¼˜åŒ–
- **åŠ¨ç”»**: å¾®å¦™ã€ä¼˜é›…çš„æ•ˆæœ

### å“åº”å¼è®¾è®¡
- âœ… ç§»åŠ¨ç«¯ä¼˜å…ˆè®¾è®¡
- âœ… iOS Safari å…¼å®¹æ€§ä¼˜åŒ–
- âœ… å¹³æ¿å’Œæ¡Œé¢ç«¯é€‚é…
- âœ… è§¦æ‘¸å‹å¥½çš„äº¤äº’è®¾è®¡

### äº¤äº’è®¾è®¡
- **åŠ è½½çŠ¶æ€**: æ¸…æ™°çš„è¿›åº¦æŒ‡ç¤º
- **é”™è¯¯å¤„ç†**: å‹å¥½çš„é”™è¯¯æç¤º
- **æˆåŠŸåé¦ˆ**: ç›´è§‚çš„æˆåŠŸçŠ¶æ€
- **æ“ä½œå¼•å¯¼**: æ¸…æ™°çš„ç”¨æˆ·æŒ‡å¼•

---

## ğŸ” æµ‹è¯•ç­–ç•¥

### åŠŸèƒ½æµ‹è¯•æ¸…å•
- [ ] ç”Ÿè¾°ä¿¡æ¯è¡¨å•æäº¤æ­£å¸¸
- [ ] AI å‘½ç†æŠ¥å‘Šç”ŸæˆæˆåŠŸ
- [ ] æ–‡è¨€å¼€ç¤ºå’Œç™½è¯è§£å¿ƒæ˜¾ç¤ºå®Œæ•´
- [ ] ğŸ® ç¯ç¬¼ç¬¦å·åŠ¨ç”»æ­£å¸¸
- [ ] æŠ¥å‘Šå›¾ç‰‡å¯¼å‡ºåŠŸèƒ½æ­£å¸¸
- [ ] ç¼“å­˜æœºåˆ¶å·¥ä½œæ­£å¸¸
- [ ] ç§»åŠ¨ç«¯å“åº”å¼é€‚é…

### æ€§èƒ½æµ‹è¯•
- [ ] API å“åº”æ—¶é—´ < 60ç§’
- [ ] é¡µé¢åŠ è½½æ—¶é—´ < 5ç§’
- [ ] å†…å­˜ä½¿ç”¨ç¨³å®š
- [ ] å¹¶å‘å¤„ç†æ­£å¸¸

### å…¼å®¹æ€§æµ‹è¯•
- [ ] Chrome æµè§ˆå™¨
- [ ] Firefox æµè§ˆå™¨
- [ ] Safari æµè§ˆå™¨ (ç‰¹åˆ«æ³¨æ„ iOS)
- [ ] ç§»åŠ¨ç«¯è®¾å¤‡

---

## ğŸ”„ ç‰ˆæœ¬è¿­ä»£è®°å½•

### V2.0.0 (å½“å‰ç‰ˆæœ¬) - 2025-01-26
**é‡å¤§å‡çº§**:
- âœ… é›†æˆäº”éƒ¨æ­£ç»Ÿå‘½ç†å…¸ç±ç†è®º
- âœ… æœ¯è¯­ç»Ÿä¸€: "æ–‡è¨€è§£è¯»" â†’ "æ–‡è¨€å¼€ç¤º"
- âœ… å­—æ•°è§„èŒƒ: 6000-9000å­—è¦æ±‚
- âœ… UI è§†è§‰ç³»ç»Ÿç°ä»£åŒ–
- âœ… ğŸ® ç¯ç¬¼ç¬¦å·åŠ¨ç”»æ•ˆæœ
- âœ… ç¼“å­˜ç³»ç»Ÿä¼˜åŒ–

### V1.0.0 (GitHub ç‰ˆæœ¬) - åŸºç¡€ç‰ˆæœ¬
**åŸºç¡€åŠŸèƒ½**:
- âœ… åŸºç¡€ Gemini AI é›†æˆ
- âœ… åŸºç¡€ UI ç»„ä»¶
- âœ… ç®€å•çš„æŠ¥å‘Šç”Ÿæˆ

---

## ğŸ“ æŠ€æœ¯æ”¯æŒä¸è”ç³»

### å¼€å‘æ–‡æ¡£
- **Genkit å®˜æ–¹æ–‡æ¡£**: https://firebase.google.com/docs/genkit
- **Google Gemini API**: https://ai.google.dev/
- **Next.js æ–‡æ¡£**: https://nextjs.org/docs

### é¡¹ç›®èµ„æº
- **GitHub ä»“åº“**: https://github.com/leon751219-cmd/fsmlgemini
- **Vercel éƒ¨ç½²**: https://vercel.com/
- **API å‚è€ƒ**: é¡¹ç›®æºä»£ç ä¸­çš„è¯¦ç»†æ³¨é‡Š

### é—®é¢˜åé¦ˆ
- **æŠ€æœ¯é—®é¢˜**: æ£€æŸ¥é¡¹ç›®æºä»£ç å’Œæ–‡æ¡£
- **åŠŸèƒ½å»ºè®®**: é€šè¿‡ GitHub Issues åé¦ˆ
- **éƒ¨ç½²é—®é¢˜**: æŸ¥çœ‹ Vercel éƒ¨ç½²æ—¥å¿—

---

**æœ€åæ›´æ–°**: 2025-01-26
**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**é¡¹ç›®çŠ¶æ€**: âœ… V2 ç‰ˆæœ¬å®Œæˆï¼Œå‡†å¤‡éƒ¨ç½²